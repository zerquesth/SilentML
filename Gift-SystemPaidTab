Shop:AddButton("Gift-System", function()
    -- Создаем основное окно
    local GiftSystemGUI = Instance.new("ScreenGui")
    local MainFrame = Instance.new("Frame")
    local TopBar = Instance.new("Frame")
    local Title = Instance.new("TextLabel")
    local CloseButton = Instance.new("TextButton")
    local ScrollingFrame = Instance.new("ScrollingFrame")
    local InventoryFolder = Instance.new("Frame")
    local InventoryTitle = Instance.new("TextLabel")
    local ProteinEggLabel = Instance.new("TextLabel")
    local TropicalShakeLabel = Instance.new("TextLabel")
    local GiftFolder = Instance.new("Frame")
    local GiftTitle = Instance.new("TextLabel")
    local PlayerDropdown = Instance.new("Frame")
    local DropdownLabel = Instance.new("TextLabel")
    local DropdownButton = Instance.new("TextButton")
    local DropdownFrame = Instance.new("Frame")
    local UIListLayout = Instance.new("UIListLayout")
    local EggGiftSection = Instance.new("Frame")
    local EggTextBox = Instance.new("TextBox")
    local EggGiftButton = Instance.new("TextButton")
    local ShakeGiftSection = Instance.new("Frame")
    local ShakeTextBox = Instance.new("TextBox")
    local ShakeGiftButton = Instance.new("TextButton")

    -- Настройка GUI
    GiftSystemGUI.Name = "GiftSystemGUI"
    GiftSystemGUI.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    GiftSystemGUI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    MainFrame.Name = "MainFrame"
    MainFrame.Parent = GiftSystemGUI
    MainFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    MainFrame.BorderSizePixel = 0
    MainFrame.Position = UDim2.new(0.3, 0, 0.2, 0)
    MainFrame.Size = UDim2.new(0, 350, 0, 400)
    MainFrame.Active = true
    MainFrame.Draggable = true

    TopBar.Name = "TopBar"
    TopBar.Parent = MainFrame
    TopBar.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    TopBar.BorderSizePixel = 0
    TopBar.Size = UDim2.new(1, 0, 0, 30)

    Title.Name = "Title"
    Title.Parent = TopBar
    Title.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    Title.BackgroundTransparency = 1.0
    Title.Position = UDim2.new(0, 10, 0, 0)
    Title.Size = UDim2.new(0, 200, 1, 0)
    Title.Font = Enum.Font.Gotham
    Title.Text = "Gift System"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.TextSize = 14
    Title.TextXAlignment = Enum.TextXAlignment.Left

    CloseButton.Name = "CloseButton"
    CloseButton.Parent = TopBar
    CloseButton.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
    CloseButton.BorderSizePixel = 0
    CloseButton.Position = UDim2.new(1, -30, 0, 5)
    CloseButton.Size = UDim2.new(0, 25, 0, 20)
    CloseButton.Font = Enum.Font.Gotham
    CloseButton.Text = "X"
    CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    CloseButton.TextSize = 12

    ScrollingFrame.Parent = MainFrame
    ScrollingFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    ScrollingFrame.BackgroundTransparency = 1.0
    ScrollingFrame.Position = UDim2.new(0, 0, 0, 30)
    ScrollingFrame.Size = UDim2.new(1, 0, 1, -30)
    ScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 500)
    ScrollingFrame.ScrollBarThickness = 5

    -- Inventory Management Section
    InventoryFolder.Name = "InventoryFolder"
    InventoryFolder.Parent = ScrollingFrame
    InventoryFolder.BackgroundColor3 = Color3.fromRGB(55, 55, 55)
    InventoryFolder.BorderSizePixel = 0
    InventoryFolder.Position = UDim2.new(0, 10, 0, 10)
    InventoryFolder.Size = UDim2.new(1, -20, 0, 80)

    InventoryTitle.Name = "InventoryTitle"
    InventoryTitle.Parent = InventoryFolder
    InventoryTitle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    InventoryTitle.BackgroundTransparency = 1.0
    InventoryTitle.Position = UDim2.new(0, 10, 0, 5)
    InventoryTitle.Size = UDim2.new(1, -20, 0, 20)
    InventoryTitle.Font = Enum.Font.GothamBold
    InventoryTitle.Text = "Inventory Management"
    InventoryTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
    InventoryTitle.TextSize = 14
    InventoryTitle.TextXAlignment = Enum.TextXAlignment.Left

    ProteinEggLabel.Name = "ProteinEggLabel"
    ProteinEggLabel.Parent = InventoryFolder
    ProteinEggLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    ProteinEggLabel.BackgroundTransparency = 1.0
    ProteinEggLabel.Position = UDim2.new(0, 10, 0, 30)
    ProteinEggLabel.Size = UDim2.new(1, -20, 0, 20)
    ProteinEggLabel.Font = Enum.Font.Gotham
    ProteinEggLabel.Text = "Protein Eggs: 0"
    ProteinEggLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    ProteinEggLabel.TextSize = 12
    ProteinEggLabel.TextXAlignment = Enum.TextXAlignment.Left

    TropicalShakeLabel.Name = "TropicalShakeLabel"
    TropicalShakeLabel.Parent = InventoryFolder
    TropicalShakeLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    TropicalShakeLabel.BackgroundTransparency = 1.0
    TropicalShakeLabel.Position = UDim2.new(0, 10, 0, 50)
    TropicalShakeLabel.Size = UDim2.new(1, -20, 0, 20)
    TropicalShakeLabel.Font = Enum.Font.Gotham
    TropicalShakeLabel.Text = "Tropical Shakes: 0"
    TropicalShakeLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    TropicalShakeLabel.TextSize = 12
    TropicalShakeLabel.TextXAlignment = Enum.TextXAlignment.Left

    -- Gift System Section
    GiftFolder.Name = "GiftFolder"
    GiftFolder.Parent = ScrollingFrame
    GiftFolder.BackgroundColor3 = Color3.fromRGB(55, 55, 55)
    GiftFolder.BorderSizePixel = 0
    GiftFolder.Position = UDim2.new(0, 10, 0, 100)
    GiftFolder.Size = UDim2.new(1, -20, 0, 250)

    GiftTitle.Name = "GiftTitle"
    GiftTitle.Parent = GiftFolder
    GiftTitle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    GiftTitle.BackgroundTransparency = 1.0
    GiftTitle.Position = UDim2.new(0, 10, 0, 5)
    GiftTitle.Size = UDim2.new(1, -20, 0, 20)
    GiftTitle.Font = Enum.Font.GothamBold
    GiftTitle.Text = "Gift System"
    GiftTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
    GiftTitle.TextSize = 14
    GiftTitle.TextXAlignment = Enum.TextXAlignment.Left

    -- Player Dropdown
    PlayerDropdown.Name = "PlayerDropdown"
    PlayerDropdown.Parent = GiftFolder
    PlayerDropdown.BackgroundColor3 = Color3.fromRGB(65, 65, 65)
    PlayerDropdown.BorderSizePixel = 0
    PlayerDropdown.Position = UDim2.new(0, 10, 0, 30)
    PlayerDropdown.Size = UDim2.new(1, -20, 0, 60)

    DropdownLabel.Name = "DropdownLabel"
    DropdownLabel.Parent = PlayerDropdown
    DropdownLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    DropdownLabel.BackgroundTransparency = 1.0
    DropdownLabel.Position = UDim2.new(0, 5, 0, 5)
    DropdownLabel.Size = UDim2.new(1, -10, 0, 15)
    DropdownLabel.Font = Enum.Font.Gotham
    DropdownLabel.Text = "Choose Player:"
    DropdownLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    DropdownLabel.TextSize = 12
    DropdownLabel.TextXAlignment = Enum.TextXAlignment.Left

    DropdownButton.Name = "DropdownButton"
    DropdownButton.Parent = PlayerDropdown
    DropdownButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    DropdownButton.BorderSizePixel = 0
    DropdownButton.Position = UDim2.new(0, 5, 0, 25)
    DropdownButton.Size = UDim2.new(1, -10, 0, 25)
    DropdownButton.Font = Enum.Font.Gotham
    DropdownButton.Text = "Select Player"
    DropdownButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    DropdownButton.TextSize = 12

    DropdownFrame.Name = "DropdownFrame"
    DropdownFrame.Parent = PlayerDropdown
    DropdownFrame.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    DropdownFrame.BorderSizePixel = 0
    DropdownFrame.Position = UDim2.new(0, 5, 1, 5)
    DropdownFrame.Size = UDim2.new(1, -10, 0, 0)
    DropdownFrame.Visible = false
    DropdownFrame.ClipsDescendants = true

    UIListLayout.Parent = DropdownFrame
    UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder

    -- Egg Gift Section
    EggGiftSection.Name = "EggGiftSection"
    EggGiftSection.Parent = GiftFolder
    EggGiftSection.BackgroundColor3 = Color3.fromRGB(65, 65, 65)
    EggGiftSection.BorderSizePixel = 0
    EggGiftSection.Position = UDim2.new(0, 10, 0, 100)
    EggGiftSection.Size = UDim2.new(1, -20, 0, 60)

    EggTextBox.Name = "EggTextBox"
    EggTextBox.Parent = EggGiftSection
    EggTextBox.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    EggTextBox.BorderSizePixel = 0
    EggTextBox.Position = UDim2.new(0, 5, 0, 5)
    EggTextBox.Size = UDim2.new(0.6, -10, 0, 25)
    EggTextBox.Font = Enum.Font.Gotham
    EggTextBox.PlaceholderText = "Egg Amount"
    EggTextBox.Text = ""
    EggTextBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    EggTextBox.TextSize = 12

    EggGiftButton.Name = "EggGiftButton"
    EggGiftButton.Parent = EggGiftSection
    EggGiftButton.BackgroundColor3 = Color3.fromRGB(60, 120, 60)
    EggGiftButton.BorderSizePixel = 0
    EggGiftButton.Position = UDim2.new(0.6, 5, 0, 5)
    EggGiftButton.Size = UDim2.new(0.4, -10, 0, 25)
    EggGiftButton.Font = Enum.Font.Gotham
    EggGiftButton.Text = "Gift Eggs"
    EggGiftButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    EggGiftButton.TextSize = 12

    -- Shake Gift Section
    ShakeGiftSection.Name = "ShakeGiftSection"
    ShakeGiftSection.Parent = GiftFolder
    ShakeGiftSection.BackgroundColor3 = Color3.fromRGB(65, 65, 65)
    ShakeGiftSection.BorderSizePixel = 0
    ShakeGiftSection.Position = UDim2.new(0, 10, 0, 170)
    ShakeGiftSection.Size = UDim2.new(1, -20, 0, 60)

    ShakeTextBox.Name = "ShakeTextBox"
    ShakeTextBox.Parent = ShakeGiftSection
    ShakeTextBox.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    ShakeTextBox.BorderSizePixel = 0
    ShakeTextBox.Position = UDim2.new(0, 5, 0, 5)
    ShakeTextBox.Size = UDim2.new(0.6, -10, 0, 25)
    ShakeTextBox.Font = Enum.Font.Gotham
    ShakeTextBox.PlaceholderText = "Shake Amount"
    ShakeTextBox.Text = ""
    ShakeTextBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    ShakeTextBox.TextSize = 12

    ShakeGiftButton.Name = "ShakeGiftButton"
    ShakeGiftButton.Parent = ShakeGiftSection
    ShakeGiftButton.BackgroundColor3 = Color3.fromRGB(60, 120, 60)
    ShakeGiftButton.BorderSizePixel = 0
    ShakeGiftButton.Position = UDim2.new(0.6, 5, 0, 5)
    ShakeGiftButton.Size = UDim2.new(0.4, -10, 0, 25)
    ShakeGiftButton.Font = Enum.Font.Gotham
    ShakeGiftButton.Text = "Gift Shakes"
    ShakeGiftButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    ShakeGiftButton.TextSize = 12

    -- Логика
    local selectedGiftPlayer = nil
    local eggGiftCount = 0
    local shakeGiftCount = 0
    local Players = game:GetService("Players")
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local player = Players.LocalPlayer

    -- Функция обновления количества предметов
    local function updateItemCount()
        local proteinEggCount = 0
        local tropicalShakeCount = 0

        local consumablesFolder = player:FindFirstChild("consumablesFolder")
        if consumablesFolder then
            for _, item in ipairs(consumablesFolder:GetChildren()) do
                if item.Name == "Protein Egg" then
                    proteinEggCount = proteinEggCount + item.Value
                elseif item.Name == "Tropical Shake" then
                    tropicalShakeCount = tropicalShakeCount + item.Value
                end
            end
        end

        ProteinEggLabel.Text = "Protein Eggs: " .. proteinEggCount
        TropicalShakeLabel.Text = "Tropical Shakes: " .. tropicalShakeCount
    end

    -- Запускаем обновление счетчиков
    task.spawn(function()
        while GiftSystemGUI.Parent do
            updateItemCount()
            task.wait(0.25)
        end
    end)

    -- Логика выпадающего списка игроков
    local function updateDropdown()
        DropdownFrame:ClearAllChildren()
        
        for _, targetPlayer in ipairs(Players:GetPlayers()) do
            if targetPlayer ~= player then
                local playerButton = Instance.new("TextButton")
                playerButton.Name = targetPlayer.Name
                playerButton.Parent = DropdownFrame
                playerButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
                playerButton.BorderSizePixel = 0
                playerButton.Size = UDim2.new(1, 0, 0, 25)
                playerButton.Font = Enum.Font.Gotham
                playerButton.Text = targetPlayer.Name
                playerButton.TextColor3 = Color3.fromRGB(255, 255, 255)
                playerButton.TextSize = 12
                
                playerButton.MouseButton1Click:Connect(function()
                    selectedGiftPlayer = targetPlayer
                    DropdownButton.Text = targetPlayer.Name
                    DropdownFrame.Visible = false
                    DropdownFrame.Size = UDim2.new(1, -10, 0, 0)
                end)
            end
        end
        
        local playerCount = #DropdownFrame:GetChildren()
        if playerCount > 0 then
            DropdownFrame.Size = UDim2.new(1, -10, 0, playerCount * 25)
        end
    end

    -- Инициализация выпадающего списка
    updateDropdown()

    -- Обновление списка при подключении/отключении игроков
    Players.PlayerAdded:Connect(function(newPlayer)
        if newPlayer ~= player then
            updateDropdown()
        end
    end)

    Players.PlayerRemoving:Connect(function(leavingPlayer)
        if selectedGiftPlayer == leavingPlayer then
            selectedGiftPlayer = nil
            DropdownButton.Text = "Select Player"
        end
        updateDropdown()
    end)

    -- Обработчики событий
    CloseButton.MouseButton1Click:Connect(function()
        GiftSystemGUI:Destroy()
    end)

    DropdownButton.MouseButton1Click:Connect(function()
        DropdownFrame.Visible = not DropdownFrame.Visible
    end)

    EggTextBox:GetPropertyChangedSignal("Text"):Connect(function()
        eggGiftCount = tonumber(EggTextBox.Text) or 0
    end)

    EggGiftButton.MouseButton1Click:Connect(function()
        if selectedGiftPlayer and eggGiftCount and eggGiftCount > 0 then
            local proteinEgg = player.consumablesFolder:FindFirstChild("Protein Egg")
            if proteinEgg then
                for i = 1, eggGiftCount do
                    ReplicatedStorage.rEvents.giftRemote:InvokeServer("giftRequest", selectedGiftPlayer, proteinEgg)
                    task.wait(0.1)
                end
            end
        end
    end)

    ShakeTextBox:GetPropertyChangedSignal("Text"):Connect(function()
        shakeGiftCount = tonumber(ShakeTextBox.Text) or 0
    end)

    ShakeGiftButton.MouseButton1Click:Connect(function()
        if selectedGiftPlayer and shakeGiftCount and shakeGiftCount > 0 then
            local tropicalShake = player.consumablesFolder:FindFirstChild("Tropical Shake")
            if tropicalShake then
                for i = 1, shakeGiftCount do
                    ReplicatedStorage.rEvents.giftRemote:InvokeServer("giftRequest", selectedGiftPlayer, tropicalShake)
                    task.wait(0.1)
                end
            end
        end
    end)
end)
