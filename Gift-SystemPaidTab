Shop:AddButton("Gift-System", function()
    -- Создаем основное окно в стиле Silent
    local GiftSystemGUI = Instance.new("ScreenGui")
    local MainFrame = Instance.new("Frame")
    local UICorner = Instance.new("UICorner")
    local TopBar = Instance.new("Frame")
    local Title = Instance.new("TextLabel")
    local CloseButton = Instance.new("TextButton")
    local ContentFrame = Instance.new("ScrollingFrame")
    local UIListLayout = Instance.new("UIListLayout")
    
    -- Секция инвентаря
    local InventorySection = Instance.new("Frame")
    local InventoryTitle = Instance.new("TextLabel")
    local ProteinEggLabel = Instance.new("TextLabel")
    local TropicalShakeLabel = Instance.new("TextLabel")
    
    -- Секция подарков
    local GiftSection = Instance.new("Frame")
    local GiftTitle = Instance.new("TextLabel")
    local PlayerDropdownFrame = Instance.new("Frame")
    local DropdownButton = Instance.new("TextButton")
    local DropdownList = Instance.new("Frame")
    local DropdownUIList = Instance.new("UIListLayout")
    
    -- Поля ввода и кнопки
    local EggGiftFrame = Instance.new("Frame")
    local EggTextBox = Instance.new("TextBox")
    local EggGiftButton = Instance.new("TextButton")
    
    local ShakeGiftFrame = Instance.new("Frame")
    local ShakeTextBox = Instance.new("TextBox")
    local ShakeGiftButton = Instance.new("TextButton")

    -- Настройка основного GUI
    GiftSystemGUI.Name = "GiftSystemGUI"
    GiftSystemGUI.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    GiftSystemGUI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    GiftSystemGUI.ResetOnSpawn = false

    MainFrame.Name = "MainFrame"
    MainFrame.Parent = GiftSystemGUI
    MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
    MainFrame.BorderSizePixel = 0
    MainFrame.Position = UDim2.new(0.3, 0, 0.25, 0)
    MainFrame.Size = UDim2.new(0, 300, 0, 350)
    MainFrame.Active = true
    MainFrame.Draggable = true

    UICorner.CornerRadius = UDim.new(0, 8)
    UICorner.Parent = MainFrame

    TopBar.Name = "TopBar"
    TopBar.Parent = MainFrame
    TopBar.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
    TopBar.BorderSizePixel = 0
    TopBar.Size = UDim2.new(1, 0, 0, 35)

    Title.Name = "Title"
    Title.Parent = TopBar
    Title.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    Title.BackgroundTransparency = 1.0
    Title.Position = UDim2.new(0, 15, 0, 0)
    Title.Size = UDim2.new(0, 200, 1, 0)
    Title.Font = Enum.Font.GothamBold
    Title.Text = "Gift System"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.TextSize = 16
    Title.TextXAlignment = Enum.TextXAlignment.Left

    CloseButton.Name = "CloseButton"
    CloseButton.Parent = TopBar
    CloseButton.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
    CloseButton.BorderSizePixel = 0
    CloseButton.Position = UDim2.new(1, -30, 0, 7)
    CloseButton.Size = UDim2.new(0, 20, 0, 20)
    CloseButton.Font = Enum.Font.GothamBold
    CloseButton.Text = "X"
    CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    CloseButton.TextSize = 12

    ContentFrame.Parent = MainFrame
    ContentFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    ContentFrame.BackgroundTransparency = 1.0
    ContentFrame.Position = UDim2.new(0, 0, 0, 35)
    ContentFrame.Size = UDim2.new(1, 0, 1, -35)
    ContentFrame.CanvasSize = UDim2.new(0, 0, 0, 400)
    ContentFrame.ScrollBarThickness = 4
    ContentFrame.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 120)

    UIListLayout.Parent = ContentFrame
    UIListLayout.Padding = UDim.new(0, 10)
    UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder

    -- Секция инвентаря
    InventorySection.Name = "InventorySection"
    InventorySection.Parent = ContentFrame
    InventorySection.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
    InventorySection.BorderSizePixel = 0
    InventorySection.Size = UDim2.new(1, -20, 0, 80)
    InventorySection.Position = UDim2.new(0, 10, 0, 0)

    local inventoryCorner = Instance.new("UICorner")
    inventoryCorner.CornerRadius = UDim.new(0, 6)
    inventoryCorner.Parent = InventorySection

    InventoryTitle.Name = "InventoryTitle"
    InventoryTitle.Parent = InventorySection
    InventoryTitle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    InventoryTitle.BackgroundTransparency = 1.0
    InventoryTitle.Position = UDim2.new(0, 10, 0, 8)
    InventoryTitle.Size = UDim2.new(1, -20, 0, 20)
    InventoryTitle.Font = Enum.Font.GothamBold
    InventoryTitle.Text = "Inventory"
    InventoryTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
    InventoryTitle.TextSize = 14
    InventoryTitle.TextXAlignment = Enum.TextXAlignment.Left

    ProteinEggLabel.Name = "ProteinEggLabel"
    ProteinEggLabel.Parent = InventorySection
    ProteinEggLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    ProteinEggLabel.BackgroundTransparency = 1.0
    ProteinEggLabel.Position = UDim2.new(0, 10, 0, 35)
    ProteinEggLabel.Size = UDim2.new(1, -20, 0, 20)
    ProteinEggLabel.Font = Enum.Font.Gotham
    ProteinEggLabel.Text = "Protein Eggs: 0"
    ProteinEggLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    ProteinEggLabel.TextSize = 12
    ProteinEggLabel.TextXAlignment = Enum.TextXAlignment.Left

    TropicalShakeLabel.Name = "TropicalShakeLabel"
    TropicalShakeLabel.Parent = InventorySection
    TropicalShakeLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    TropicalShakeLabel.BackgroundTransparency = 1.0
    TropicalShakeLabel.Position = UDim2.new(0, 10, 0, 55)
    TropicalShakeLabel.Size = UDim2.new(1, -20, 0, 20)
    TropicalShakeLabel.Font = Enum.Font.Gotham
    TropicalShakeLabel.Text = "Tropical Shakes: 0"
    TropicalShakeLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    TropicalShakeLabel.TextSize = 12
    TropicalShakeLabel.TextXAlignment = Enum.TextXAlignment.Left

    -- Секция подарков
    GiftSection.Name = "GiftSection"
    GiftSection.Parent = ContentFrame
    GiftSection.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
    GiftSection.BorderSizePixel = 0
    GiftSection.Size = UDim2.new(1, -20, 0, 200)
    GiftSection.Position = UDim2.new(0, 10, 0, 90)

    local giftCorner = Instance.new("UICorner")
    giftCorner.CornerRadius = UDim.new(0, 6)
    giftCorner.Parent = GiftSection

    GiftTitle.Name = "GiftTitle"
    GiftTitle.Parent = GiftSection
    GiftTitle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    GiftTitle.BackgroundTransparency = 1.0
    GiftTitle.Position = UDim2.new(0, 10, 0, 8)
    GiftTitle.Size = UDim2.new(1, -20, 0, 20)
    GiftTitle.Font = Enum.Font.GothamBold
    GiftTitle.Text = "Send Gifts"
    GiftTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
    GiftTitle.TextSize = 14
    GiftTitle.TextXAlignment = Enum.TextXAlignment.Left

    -- Выбор игрока
    PlayerDropdownFrame.Name = "PlayerDropdownFrame"
    PlayerDropdownFrame.Parent = GiftSection
    PlayerDropdownFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
    PlayerDropdownFrame.BorderSizePixel = 0
    PlayerDropdownFrame.Position = UDim2.new(0, 10, 0, 35)
    PlayerDropdownFrame.Size = UDim2.new(1, -20, 0, 35)

    local dropdownCorner = Instance.new("UICorner")
    dropdownCorner.CornerRadius = UDim.new(0, 4)
    dropdownCorner.Parent = PlayerDropdownFrame

    DropdownButton.Name = "DropdownButton"
    DropdownButton.Parent = PlayerDropdownFrame
    DropdownButton.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
    DropdownButton.BorderSizePixel = 0
    DropdownButton.Size = UDim2.new(1, 0, 1, 0)
    DropdownButton.Font = Enum.Font.Gotham
    DropdownButton.Text = "Select Player"
    DropdownButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    DropdownButton.TextSize = 12

    DropdownList.Name = "DropdownList"
    DropdownList.Parent = PlayerDropdownFrame
    DropdownList.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
    DropdownList.BorderSizePixel = 0
    DropdownList.Position = UDim2.new(0, 0, 1, 2)
    DropdownList.Size = UDim2.new(1, 0, 0, 0)
    DropdownList.Visible = false
    DropdownList.ClipsDescendants = true

    local listCorner = Instance.new("UICorner")
    listCorner.CornerRadius = UDim.new(0, 4)
    listCorner.Parent = DropdownList

    DropdownUIList.Parent = DropdownList
    DropdownUIList.SortOrder = Enum.SortOrder.LayoutOrder

    -- Подарок яиц
    EggGiftFrame.Name = "EggGiftFrame"
    EggGiftFrame.Parent = GiftSection
    EggGiftFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
    EggGiftFrame.BorderSizePixel = 0
    EggGiftFrame.Position = UDim2.new(0, 10, 0, 80)
    EggGiftFrame.Size = UDim2.new(1, -20, 0, 35)

    local eggCorner = Instance.new("UICorner")
    eggCorner.CornerRadius = UDim.new(0, 4)
    eggCorner.Parent = EggGiftFrame

    EggTextBox.Name = "EggTextBox"
    EggTextBox.Parent = EggGiftFrame
    EggTextBox.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
    EggTextBox.BorderSizePixel = 0
    EggTextBox.Position = UDim2.new(0, 5, 0, 5)
    EggTextBox.Size = UDim2.new(0.6, -10, 0, 25)
    EggTextBox.Font = Enum.Font.Gotham
    EggTextBox.PlaceholderText = "Egg Amount"
    EggTextBox.Text = ""
    EggTextBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    EggTextBox.TextSize = 12
    EggTextBox.ClearTextOnFocus = false

    EggGiftButton.Name = "EggGiftButton"
    EggGiftButton.Parent = EggGiftFrame
    EggGiftButton.BackgroundColor3 = Color3.fromRGB(70, 130, 70)
    EggGiftButton.BorderSizePixel = 0
    EggGiftButton.Position = UDim2.new(0.6, 5, 0, 5)
    EggGiftButton.Size = UDim2.new(0.4, -10, 0, 25)
    EggGiftButton.Font = Enum.Font.Gotham
    EggGiftButton.Text = "Gift Eggs"
    EggGiftButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    EggGiftButton.TextSize = 12

    -- Подарок шейков
    ShakeGiftFrame.Name = "ShakeGiftFrame"
    ShakeGiftFrame.Parent = GiftSection
    ShakeGiftFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
    ShakeGiftFrame.BorderSizePixel = 0
    ShakeGiftFrame.Position = UDim2.new(0, 10, 0, 125)
    ShakeGiftFrame.Size = UDim2.new(1, -20, 0, 35)

    local shakeCorner = Instance.new("UICorner")
    shakeCorner.CornerRadius = UDim.new(0, 4)
    shakeCorner.Parent = ShakeGiftFrame

    ShakeTextBox.Name = "ShakeTextBox"
    ShakeTextBox.Parent = ShakeGiftFrame
    ShakeTextBox.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
    ShakeTextBox.BorderSizePixel = 0
    ShakeTextBox.Position = UDim2.new(0, 5, 0, 5)
    ShakeTextBox.Size = UDim2.new(0.6, -10, 0, 25)
    ShakeTextBox.Font = Enum.Font.Gotham
    ShakeTextBox.PlaceholderText = "Shake Amount"
    ShakeTextBox.Text = ""
    ShakeTextBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    ShakeTextBox.TextSize = 12
    ShakeTextBox.ClearTextOnFocus = false

    ShakeGiftButton.Name = "ShakeGiftButton"
    ShakeGiftButton.Parent = ShakeGiftFrame
    ShakeGiftButton.BackgroundColor3 = Color3.fromRGB(70, 130, 70)
    ShakeGiftButton.BorderSizePixel = 0
    ShakeGiftButton.Position = UDim2.new(0.6, 5, 0, 5)
    ShakeGiftButton.Size = UDim2.new(0.4, -10, 0, 25)
    ShakeGiftButton.Font = Enum.Font.Gotham
    ShakeGiftButton.Text = "Gift Shakes"
    ShakeGiftButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    ShakeGiftButton.TextSize = 12

    -- Логика системы
    local selectedGiftPlayer = nil
    local eggGiftCount = 0
    local shakeGiftCount = 0
    local Players = game:GetService("Players")
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local player = Players.LocalPlayer

    -- Функция обновления количества предметов
    local function updateItemCount()
        local proteinEggCount = 0
        local tropicalShakeCount = 0

        local consumablesFolder = player:FindFirstChild("consumablesFolder")
        if consumablesFolder then
            for _, item in ipairs(consumablesFolder:GetChildren()) do
                if item.Name == "Protein Egg" then
                    proteinEggCount = proteinEggCount + item.Value
                elseif item.Name == "Tropical Shake" then
                    tropicalShakeCount = tropicalShakeCount + item.Value
                end
            end
        end

        ProteinEggLabel.Text = "Protein Eggs: " .. proteinEggCount
        TropicalShakeLabel.Text = "Tropical Shakes: " .. tropicalShakeCount
    end

    -- Запускаем обновление счетчиков
    task.spawn(function()
        while GiftSystemGUI.Parent do
            updateItemCount()
            task.wait(0.25)
        end
    end)

    -- Логика выпадающего списка игроков
    local function updateDropdown()
        DropdownList:ClearAllChildren()
        
        for _, targetPlayer in ipairs(Players:GetPlayers()) do
            if targetPlayer ~= player then
                local playerButton = Instance.new("TextButton")
                playerButton.Name = targetPlayer.Name
                playerButton.Parent = DropdownList
                playerButton.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
                playerButton.BorderSizePixel = 0
                playerButton.Size = UDim2.new(1, 0, 0, 25)
                playerButton.Font = Enum.Font.Gotham
                playerButton.Text = targetPlayer.Name
                playerButton.TextColor3 = Color3.fromRGB(255, 255, 255)
                playerButton.TextSize = 12
                
                playerButton.MouseButton1Click:Connect(function()
                    selectedGiftPlayer = targetPlayer
                    DropdownButton.Text = targetPlayer.Name
                    DropdownList.Visible = false
                    DropdownList.Size = UDim2.new(1, 0, 0, 0)
                end)
            end
        end
        
        local playerCount = #DropdownList:GetChildren()
        if playerCount > 0 then
            DropdownList.Size = UDim2.new(1, 0, 0, playerCount * 25)
        end
    end

    -- Инициализация выпадающего списка
    updateDropdown()

    -- Обновление списка при подключении/отключении игроков
    Players.PlayerAdded:Connect(function(newPlayer)
        if newPlayer ~= player then
            updateDropdown()
        end
    end)

    Players.PlayerRemoving:Connect(function(leavingPlayer)
        if selectedGiftPlayer == leavingPlayer then
            selectedGiftPlayer = nil
            DropdownButton.Text = "Select Player"
        end
        updateDropdown()
    end)

    -- Обработчики событий
    CloseButton.MouseButton1Click:Connect(function()
        GiftSystemGUI:Destroy()
    end)

    DropdownButton.MouseButton1Click:Connect(function()
        DropdownList.Visible = not DropdownList.Visible
    end)

    EggTextBox:GetPropertyChangedSignal("Text"):Connect(function()
        eggGiftCount = tonumber(EggTextBox.Text) or 0
    end)

    EggGiftButton.MouseButton1Click:Connect(function()
        if selectedGiftPlayer and eggGiftCount and eggGiftCount > 0 then
            local proteinEgg = player.consumablesFolder:FindFirstChild("Protein Egg")
            if proteinEgg then
                for i = 1, eggGiftCount do
                    ReplicatedStorage.rEvents.giftRemote:InvokeServer("giftRequest", selectedGiftPlayer, proteinEgg)
                    task.wait(0.1)
                end
                EggTextBox.Text = ""
            end
        end
    end)

    ShakeTextBox:GetPropertyChangedSignal("Text"):Connect(function()
        shakeGiftCount = tonumber(ShakeTextBox.Text) or 0
    end)

    ShakeGiftButton.MouseButton1Click:Connect(function()
        if selectedGiftPlayer and shakeGiftCount and shakeGiftCount > 0 then
            local tropicalShake = player.consumablesFolder:FindFirstChild("Tropical Shake")
            if tropicalShake then
                for i = 1, shakeGiftCount do
                    ReplicatedStorage.rEvents.giftRemote:InvokeServer("giftRequest", selectedGiftPlayer, tropicalShake)
                    task.wait(0.1)
                end
                ShakeTextBox.Text = ""
            end
        end
    end)
end)
